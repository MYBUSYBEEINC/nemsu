<?php//SHOW APPOINTMENT DATA IN DATATABLEglobal $wpdb;$staff_table =  $wpdb->prefix."apt_staff";$client_table = $wpdb->prefix.'apt_clients';$current_user = wp_get_current_user();$staff_mail = $current_user->user_email;$count = $wpdb->get_var($wpdb->prepare("SELECT COUNT(*) FROM `$staff_table` WHERE staff_email = %s", $staff_mail));  /* for customer */$count_client = $wpdb->get_var($wpdb->prepare("SELECT COUNT(*) FROM `$client_table` WHERE email = %s", $staff_mail));$role = $current_user->roles;$current_role = $role[0];$weblizar_aps_staff_dashboard = get_option("weblizar_aps_staff_dashboard_settings");$staff_appointment_setting = $weblizar_aps_staff_dashboard['staff_appointment_setting'];$staff_dashboard_setting = $weblizar_aps_staff_dashboard['staff_dashboard_setting'];$appointment_edit = $weblizar_aps_staff_dashboard['appointment_edit'];/*for staff dashboard*/if(isset($staff_mail) && $count == 1 && $current_role != "administrator" && $appointment_edit == "yes"){  $staff = $user_staff = $wpdb->get_row( "SELECT * FROM `$staff_table` WHERE staff_email = '$staff_mail'" );  if($staff) {    $ap_fecth=$wpdb->get_results("select * from $wpdb->prefix"."apt_appointments where staff_member= '$staff->id'");      $num_rows=count($ap_fecth);  } else {    $ap_fecth=array();      $num_rows=0;  }if($num_rows !==0){ foreach($ap_fecth as $value){  $id=$value->id;  $client_email = $value->client_email;  $client_name = $value->client_name;  $staff_member = $value->staff_member;  if(!empty($value->location_id)){    $location = $value->location_id;    }  else{    $location = 1;  }  $ap_fecth_staff = $wpdb->get_results("select * from $wpdb->prefix"."apt_staff where id='$staff_member'");  foreach($ap_fecth_staff as $ap_fecth_single_staff){    $staff_name = $ap_fecth_single_staff->staff_member_name;    $staff_email = $ap_fecth_single_staff->staff_email;    /*location name*/    $ap_fetch_location_name_query = $wpdb->get_row("select * from $wpdb->prefix"."apt_location where id='$location'");    $location_name = $ap_fetch_location_name_query->location_add;}      $service_type=$value->service_type;    $contact =$value->contact ;    $booking_date=$value->booking_date ;    $start_time =$value->start_time ;    $end_time=$value->end_time;    $status=$value->status;    $results["data"][] =array('<input type="checkbox" name="check[]" id="appoint_check" class="checkbox1" value="'.$id.'"/>',$id,array($booking_date,$start_time,"To",$end_time),$staff_name,$client_name,$service_type,    '<select size="1" class="payment_status_value" name="payment_status1" apt_client_name="'.$client_name.'" apt_date="'.$booking_date.'" apt_time="'.$start_time.'" apt_end_time="'.$end_time.'" apt_service_name="'.$service_type.'" apt_staff_name="'.$staff_name.'"  apt_staff_email="'.$staff_email.'"  title="'.$client_email.'" data-id="'.$id.'">          <option value="pending"'.(($status == 'pending')?'selected':"").'>'.__("Pending",WL_A_P_SYSTEM).'</option>          <option value="approved"'.(($status == 'approved')?'selected':"").'>'.__("Approved",WL_A_P_SYSTEM).'</option>          <option value="cancel" '.(($status == 'cancel')?'selected':"").'>'.__("Cancel",WL_A_P_SYSTEM).'</option>          <option value="completed" '.(($status == 'completed')?'selected':"").'>'.__("Completed",WL_A_P_SYSTEM).'</option>    </select>',    $contact,$location_name,array('<a class="edit" style="margin-right: 5px;" href="#update_appoin_model"  data-backdrop="true" data-toggle="modal"  data-id="'.$id.'"><i class="fas fa-pen"></i></a> &nbsp <a href="#'.$id.'" class="del_appoint">  <i class="fas fa-trash"></i></a>'));   }}else{  $results["data"][] =array(null,null,null,null,__('No appointment add',WL_A_P_SYSTEM),null,null,null,null,null); }}else if(isset($staff_mail) && $count == 1 && $current_role != "administrator" && $appointment_edit == "no"){  $staff = $user_staff = $wpdb->get_row( "SELECT * FROM `$staff_table` WHERE staff_email = '$staff_mail'" );  if($staff) {    $ap_fecth=$wpdb->get_results("select * from $wpdb->prefix"."apt_appointments where staff_member= '$staff->id'");      $num_rows=count($ap_fecth);  } else {    $ap_fecth=array();      $num_rows=0;  }if($num_rows !==0){ foreach($ap_fecth as $value){  $id=$value->id;  $client_email = $value->client_email;  $client_name = $value->client_name;  $staff_member = $value->staff_member;  if(!empty($value->location_id)){    $location = $value->location_id;    }  else{    $location = 1;  }  $ap_fecth_staff = $wpdb->get_results("select * from $wpdb->prefix"."apt_staff where id='$staff_member'");  foreach($ap_fecth_staff as $ap_fecth_single_staff){    $staff_name = $ap_fecth_single_staff->staff_member_name;    $staff_email = $ap_fecth_single_staff->staff_email;    /*location name*/    $ap_fetch_location_name_query = $wpdb->get_row("select * from $wpdb->prefix"."apt_location where id='$location'");    $location_name = $ap_fetch_location_name_query->location_add;}      $service_type=$value->service_type;    $contact =$value->contact ;    $booking_date=$value->booking_date ;    $start_time =$value->start_time ;    $end_time=$value->end_time;    $status=$value->status;    $results["data"][] =array('<input type="checkbox" name="check[]" id="appoint_check" class="checkbox1" value="'.$id.'"/>',$id,array($booking_date,$start_time,"To",$end_time),$staff_name,$client_name,$service_type,    '<select size="1" class="payment_status_value" name="payment_status1" apt_client_name="'.$client_name.'" apt_date="'.$booking_date.'" apt_time="'.$start_time.'" apt_end_time="'.$end_time.'" apt_service_name="'.$service_type.'" apt_staff_name="'.$staff_name.'"  apt_staff_email="'.$staff_email.'"  title="'.$client_email.'" data-id="'.$id.'">          <option value="pending"'.(($status == 'pending')?'selected':"").'>'.__("Pending",WL_A_P_SYSTEM).'</option>          <option value="approved"'.(($status == 'approved')?'selected':"").'>'.__("Approved",WL_A_P_SYSTEM).'</option>          <option value="cancel" '.(($status == 'cancel')?'selected':"").'>'.__("Cancel",WL_A_P_SYSTEM).'</option>          <option value="completed" '.(($status == 'completed')?'selected':"").'>'.__("Completed",WL_A_P_SYSTEM).'</option>    </select>',    $contact,$location_name,array());   }}else{  $results["data"][] =array(null,null,null,null,__('No appointment add',WL_A_P_SYSTEM),null,null,null,null,null); }}/*for customer*/else if($current_role != "administrator" && $count_client == 1){  $ap_fecth=$wpdb->get_results("select * from $wpdb->prefix"."apt_appointments where client_email= '$staff_mail'");   $num_rows=count($ap_fecth);if($num_rows !==0){ foreach($ap_fecth as $value){  $id=$value->id;  $client_email=$value->client_email;  $client_name=$value->client_name;  $staff_member=$value->staff_member;  //$location = $value->location_id;  if(!empty($value->location_id)){    $location = $value->location_id;    }  else{    $location = 1;  }  $ap_fecth_staff=$wpdb->get_results("select * from $wpdb->prefix"."apt_staff where id='$staff_member'");  foreach($ap_fecth_staff as $ap_fecth_single_staff){  $staff_name= $ap_fecth_single_staff->staff_member_name;  $staff_email= $ap_fecth_single_staff->staff_email;  /*location name*/  $ap_fetch_location_name_query = $wpdb->get_row("select * from $wpdb->prefix"."apt_location where id='$location'");  $location_name = $ap_fetch_location_name_query->location_add;}      $service_type=$value->service_type;    $contact =$value->contact ;    $booking_date=$value->booking_date ;    $start_time =$value->start_time ;    $end_time=$value->end_time;    $status=$value->status;    $results["data"][] =array('<input type="checkbox" name="check[]" id="appoint_check" class="checkbox1" value="'.$id.'"/>',$id,array($booking_date,$start_time,"To",$end_time),$staff_name,$client_name,$service_type,    $status,$contact,$location_name,array());   }}else{  $results["data"][] =array(null,null,null,null,__('No appointment add',WL_A_P_SYSTEM),null,null,null,null,null); }}else{  $ap_fecth=$wpdb->get_results("select * from $wpdb->prefix"."apt_appointments");  $num_rows=count($ap_fecth);if($num_rows !==0){ foreach($ap_fecth as $value){  $id=$value->id;  $client_email=$value->client_email;  $client_name=$value->client_name;  $staff_member=$value->staff_member;  //$location = $value->location_id;  if(!empty($value->location_id)){    $location = $value->location_id;    }  else{    $location = 1;  }  $ap_fecth_staff=$wpdb->get_results("select * from $wpdb->prefix"."apt_staff where id='$staff_member'");  foreach($ap_fecth_staff as $ap_fecth_single_staff){  $staff_name= $ap_fecth_single_staff->staff_member_name;  $staff_email= $ap_fecth_single_staff->staff_email;   /*location name*/  $ap_fetch_location_name_query = $wpdb->get_row("select * from $wpdb->prefix"."apt_location where id='$location'");  $location_name = $ap_fetch_location_name_query->location_add;}      $service_type=$value->service_type;    $contact =$value->contact ;    $temp_booking_date=$value->booking_date ;    $booking_date=date("d-m-Y", strtotime($temp_booking_date));    $start_time =$value->start_time ;    $end_time=$value->end_time;    $status=$value->status;    $results["data"][] =array('<input type="checkbox" name="check[]" id="appoint_check" class="checkbox1" value="'.$id.'"/>',$id,array($booking_date,$start_time,"To",$end_time),$staff_name,$client_name,$service_type,    '<select size="1" class="payment_status_value" name="payment_status1" apt_client_name="'.$client_name.'" apt_date="'.$booking_date.'" apt_time="'.$start_time.'" apt_end_time="'.$end_time.'" apt_service_name="'.$service_type.'" apt_staff_name="'.$staff_name.'"  apt_staff_email="'.$staff_email.'"  title="'.$client_email.'" data-id="'.$id.'">          <option value="pending"'.(($status == 'pending')?'selected':"").'>'.__("Pending",WL_A_P_SYSTEM).'</option>          <option value="approved"'.(($status == 'approved')?'selected':"").'>'.__("Approved",WL_A_P_SYSTEM).'</option>          <option value="cancel" '.(($status == 'cancel')?'selected':"").'>'.__("Cancel",WL_A_P_SYSTEM).'</option>          <option value="completed" '.(($status == 'completed')?'selected':"").'>'.__("Completed",WL_A_P_SYSTEM).'</option>    </select>',    $contact,$location_name,array('<a class="edit" style="margin-right: 5px;" href="#update_appoin_model"  data-backdrop="true" data-toggle="modal"  data-id="'.$id.'"><i class="fas fa-pen"></i></a> &nbsp <a href="#'.$id.'" class="del_appoint">  <i class="fas fa-trash"></i></a>'));   }}else{   $results["data"][] =array(null,null,null,null,__('No appointment add',WL_A_P_SYSTEM),null,null,null,null,null); }}if($results != null){        wp_send_json($results); // encode and send response    }else wp_send_json_error(); // {"success":false}  ?>